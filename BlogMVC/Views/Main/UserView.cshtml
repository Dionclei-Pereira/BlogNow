@model BlogMVC.Models.User;
@{
    string Email = "";
    if (Model != null)
    {
        ViewData["Title"] = Model.NickName;
        Email = User.Identity.Name;
        Model.Posts = Model.Posts.OrderByDescending(d => d.Date).ToList();
    }
}
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
    <link rel="stylesheet" href="~/css/style.css" asp-append-version="true" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    </head>
    <body>
    <h1>@ViewData["Title"]</h1>
    <h6>@Model.UserName</h6>
    <br />
    @if (Model.Posts != null)
    {
        foreach (var post in Model.Posts)
        {
            <div class="Post">
                <div class="User">
                    <a class="user" asp-action="UserView" asp-route-id="@post.Owner">@Html.DisplayFor(modelItem => post.Owner)</a>
                </div>
                <div class="Comment">
                    <p>@Html.DisplayFor(ModelItem => post.Message)</p>
                    <div class="Like">
                        @if (post.likedpeople.FirstOrDefault(x => x.PersonalEmail == User.Identity.Name) != null)
                        {
                            <button class="heart-liked" data-postid="@post.Id"></button>
                        }
                        else
                        {
                            <button class="heart" data-postid="@post.Id"></button>
                        }
                        <p class="like-count">Likes: <span id="likes-count-@post.Id">@post.Likes</span></p>
                        @if (Model.Email == User.Identity.Name) {
                            <form action="@Url.Action("DeletePost", "Main")" method="post">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="owner" value="@Email" />
                                <input type="hidden" name="id" value="@post.Id" />
                                <button class="delete-btn" type="submit" onclick="return confirm('Are you sure?')">Delete</button>
                            </form>
                            }
                    </div>
                    <p>@Html.DisplayFor(ModelItem => post.Date)</p>
                </div>
            </div>
            <br />
            <br />
        }
    }
    <script>
        var email = '@Email';
        $(document).ready(function () {
            $('.heart, .heart-liked').click(function () {
                var postId = $(this).data('postid');
                $.ajax({
                    type: 'POST',
                    url: '/Main/LikePost',
                    data: { postId: postId, email: email },
                    success: function (response) {
                        if (response.error != null) {
                            alert(response.error);
                            return;
                        }
                        $('[data-postid= "' + postId + '"]').attr('class', response.status);
                        $('#likes-count-' + postId).text(response.likes);
                    },
                    error: function () {
                        alert('Error');
                    }
                });
            });
        });
    </script>
    </body>
</html>

